generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  domains   Domain[]
}

model Domain {
  id         String    @id @default(cuid())
  domain     String    @unique
  verified   Boolean   @default(false)
  mxVerified Boolean   @default(false)
  userId     String
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  addresses  Address[]
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
}

model Address {
  id        String   @id @default(cuid())
  localPart String
  catchAll  Boolean  @default(false)
  domainId  String
  domain    Domain   @relation(fields: [domainId], references: [id], onDelete: Cascade)
  emails    Email[]
  createdAt DateTime @default(now())

  @@unique([localPart, domainId])
}

model Email {
  id          String       @id @default(cuid())
  messageId   String       @unique
  fromAddress String
  fromName    String?
  toAddress   String
  subject     String
  textContent String?
  htmlContent String?
  rawContent  String
  addressId   String
  address     Address      @relation(fields: [addressId], references: [id], onDelete: Cascade)
  isRead      Boolean      @default(false)
  isStarred   Boolean      @default(false)
  receivedAt  DateTime     @default(now())
  attachments Attachment[]
}

model Attachment {
  id          String @id @default(cuid())
  filename    String
  contentType String
  size        Int
  path        String
  emailId     String
  email       Email  @relation(fields: [emailId], references: [id], onDelete: Cascade)
}
